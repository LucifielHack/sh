i=47500
url=`cat /root/var.txt`
for var in `cat /root/var.txt`
do
#81 8443 8080 8000 8880
echo "http://${var}" >> /root/var1231.txt
echo "http://${var}:81" >> /root/var1231.txt
echo "http://${var}:8443" >> /root/var1231.txt
echo "http://${var}:8080" >> /root/var1231.txt
echo "http://${var}:8000" >> /root/var1231.txt
echo "http://${var}:8880" >> /root/var1231.txt

echo "https://${var}" >> /root/var1231.txt
echo "https://${var}:81" >> /root/var1231.txt
echo "https://${var}:8443" >> /root/var1231.txt
echo "https://${var}:8080" >> /root/var1231.txt
echo "https://${var}:8000" >> /root/var1231.txt
echo "https://${var}:8880" >> /root/var1231.txt
done

vl /root/var1231.txt | grep -v "\[50" | grep -oP "http.*" >> /root/var123.txt ; rm /root/var1231.txt
sort -u /root/var123.txt -o /root/var123.txt

#whatsweb
webanalyze -update
for line in `cat /root/var123.txt`
do
echo "webanalyze -crawl 12 -host $line -output csv >> /root/whatsweb.txt ; sort -u /root/whatsweb.txt -o /root/whatsweb.txt ; wc -l /root/whatsweb.txt" > analyze.sh ; timeout 36 bash analyze.sh ; rm analyze.sh
done
rm /root/var123.txt








while true
do

comm=`cat /root/var.txt`
if [ "$url" != "$comm" ]
then

for var in `cat /root/var.txt`
do
#81 8443 8080 8000 8880
echo "http://${var}" >> /root/var1231.txt
echo "http://${var}:81" >> /root/var1231.txt
echo "http://${var}:8443" >> /root/var1231.txt
echo "http://${var}:8080" >> /root/var1231.txt
echo "http://${var}:8000" >> /root/var1231.txt
echo "http://${var}:8880" >> /root/var1231.txt

echo "https://${var}" >> /root/var1231.txt
echo "https://${var}:81" >> /root/var1231.txt
echo "https://${var}:8443" >> /root/var1231.txt
echo "https://${var}:8080" >> /root/var1231.txt
echo "https://${var}:8000" >> /root/var1231.txt
echo "https://${var}:8880" >> /root/var1231.txt
done

vl /root/var1231.txt | grep -v "\[50" | grep -oP "http.*" >> /root/var123.txt ; rm /root/var1231.txt
sort -u /root/var123.txt -o /root/var123.txt
#whatsweb
webanalyze -update
for line in `cat /root/var123.txt`
do
echo "webanalyze -crawl 12 -host $line -output csv >> /root/whatsweb.txt ; sort -u /root/whatsweb.txt -o /root/whatsweb.txt ; wc -l /root/whatsweb.txt" > analyze.sh ; timeout 36 bash analyze.sh ; rm analyze.sh
done
rm /root/var123.txt
url=$comm

fi







#确认存在
a=`curl --speed-time 5 --speed-limit 1  https://www.exploit-db.com/download/${i} | grep "Exploit\ Database\ 404"`

if [ "$a" = "" ]
then


#确认类型
web=`curl --speed-time 5 --speed-limit 1  https://www.exploit-db.com/exploits/${i} | grep -oP "type=webapps"`
curl --speed-time 5 --speed-limit 1  https://www.exploit-db.com/exploits/${i} > curl.txt

if [ "$web" = "type=webapps" ]
then

#提取指纹
grep -oP "http.*" whatsweb.txt | awk -F, '{print $(NF-1)}' > service.txt ; sort -u service.txt -o service.txt
num=`cat service.txt | wc -l`

#匹配
for((wordnum=1;wordnum<=${num};wordnum+=1))
do
word=`head -$wordnum service.txt | tail -1`
grep2=`cat curl.txt | grep -oP "title.*?title" | grep -i "$word"`
#存在则执行
if [ "$grep2" != "" ]
then
echo "s=hooks.sl ; c=ack.com/ser ; k=vices/TM26L9 ; sck=\$s\$c\$k ; curl -X POST -H \"Content-type:application/json\" --data '{\"text\":\"${grep2}_${word}_https://www.exploit-db.com/exploits/${i}\"}' https://\${sck}ZEE/BM78UTLGH/GBt3k5B25BqAyc5EDzYPDdhg" > slack.sh
bash slack.sh ; rm slack.sh
fi
done
rm service.txt

fi
i=$((i+1))
echo $i
sleep 2
else
sleep=`seq 6 16 | shuf -n 1`
sleep $sleep
fi
done
